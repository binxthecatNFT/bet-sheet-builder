<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Parlay + Player (Phone)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link
    href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap"
    rel="stylesheet"
  />
  <style>
    :root {
      --bg: #05081a;
      --panel: #0b1023;
      --panel-soft: #141c3a;
      --accent: #ff6b3d;
      --accent-soft: #ff9c6d;
      --text: #f5f5f5;
      --muted: #94a3b8;
      --radius-lg: 16px;
      --radius-full: 999px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: radial-gradient(circle at top, #182342 0, var(--bg) 55%);
      color: var(--text);
    }

    .app {
      max-width: 480px;
      margin: 0 auto;
      padding: 16px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    header {
      font-family: "Bebas Neue", system-ui, sans-serif;
      letter-spacing: 0.08em;
      font-size: 24px;
      text-transform: uppercase;
      text-align: left;
      padding: 8px 0;
    }

    .panel {
      background: radial-gradient(circle at top left, #1c2650, var(--panel));
      border-radius: var(--radius-lg);
      padding: 12px;
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.55);
    }

    .panel-title {
      font-size: 13px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--muted);
      margin-bottom: 6px;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 12px;
    }

    .field label {
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.06em;
      font-size: 11px;
    }

    input[type="text"],
    input[type="number"],
    input[type="color"] {
      width: 100%;
      border-radius: 8px;
      border: none;
      padding: 6px 8px;
      background: rgba(15, 23, 42, 0.9);
      color: var(--text);
      font-size: 13px;
      outline: none;
    }

    input[type="text"]::placeholder {
      color: #64748b;
    }

    input[type="range"] {
      width: 100%;
    }

    .file-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .file-button {
      position: relative;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 8px 14px;
      border-radius: var(--radius-full);
      background: var(--panel-soft);
      color: var(--text);
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      cursor: pointer;
      border: 1px solid rgba(148, 163, 184, 0.25);
    }

    .file-button:hover {
      border-color: var(--accent-soft);
    }

    .file-button input[type="file"] {
      position: absolute;
      inset: 0;
      opacity: 0;
      cursor: pointer;
    }

    .preview-wrapper {
      background: #000;
      border-radius: var(--radius-lg);
      padding: 8px;
      margin-top: 6px;
    }

    /* Canvas preview: scaled but not cropped */
    #previewCanvas {
      display: block;
      width: 100%;
      height: auto;
      border-radius: 12px;
      background: #020617;
    }

    .actions {
      margin-top: 12px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    #downloadBtn {
      width: 100%;
      border: none;
      border-radius: var(--radius-full);
      background: linear-gradient(135deg, var(--accent), var(--accent-soft));
      color: #0f172a;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      padding: 12px;
      font-size: 13px;
      cursor: pointer;
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.6);
    }

    #downloadBtn:active {
      transform: translateY(1px);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.7);
    }

    .hint {
      font-size: 11px;
      color: var(--muted);
      text-align: center;
      line-height: 1.4;
    }

    /* BG presets strip */
    .bg-presets-label {
      margin-top: 10px;
      margin-bottom: 4px;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--muted);
    }

    .bg-presets {
      display: flex;
      flex-wrap: nowrap;
      gap: 8px;
      overflow-x: auto;
      padding-bottom: 2px;
    }

    .bg-preset {
      border: none;
      padding: 0;
      background: transparent;
      border-radius: 10px;
      position: relative;
      cursor: pointer;
      flex: 0 0 auto;
    }

    .bg-preset img {
      display: block;
      width: 90px;
      height: 56px;
      object-fit: cover;
      border-radius: inherit;
      border: 1px solid rgba(148, 163, 184, 0.6);
    }

    .bg-preset span {
      position: absolute;
      left: 6px;
      bottom: 4px;
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #e5e7eb;
      text-shadow: 0 0 5px rgba(0, 0, 0, 0.75);
    }

    .bg-preset.active img {
      border-color: var(--accent-soft);
      box-shadow: 0 0 0 2px rgba(248, 250, 252, 0.2);
    }
  </style>
</head>
<body>
  <div class="app">
    <header>Parlay + Player (Phone)</header>

    <!-- TEXT CONTROLS -->
    <section class="panel">
      <div class="panel-title">Text</div>
      <div class="grid">
        <div class="field">
          <label for="text1">T1 text</label>
          <input id="text1" type="text" placeholder="@LETSCASHSLIPS" />
        </div>
        <div class="field">
          <label for="t1Size">T1 size</label>
          <input id="t1Size" type="number" min="20" max="200" />
        </div>
        <div class="field">
          <label for="text1Color">T1 color</label>
          <input id="text1Color" type="color" />
        </div>

        <div class="field">
          <label for="text2">T2 text</label>
          <input id="text2" type="text" placeholder="WEEK 13 PARLAYS" />
        </div>
        <div class="field">
          <label for="t2Size">T2 size</label>
          <input id="t2Size" type="number" min="20" max="200" />
        </div>
        <div class="field">
          <label for="text2Color">T2 color</label>
          <input id="text2Color" type="color" />
        </div>
      </div>

      <div class="grid" style="margin-top:8px;">
        <div class="field">
          <label for="t1x">T1 X</label>
          <input id="t1x" type="range" min="0" max="100" step="0.5" />
        </div>
        <div class="field">
          <label for="t1y">T1 Y</label>
          <input id="t1y" type="range" min="0" max="100" step="0.5" />
        </div>
        <div class="field">
          <label for="t2x">T2 X</label>
          <input id="t2x" type="range" min="0" max="100" step="0.5" />
        </div>
        <div class="field">
          <label for="t2y">T2 Y</label>
          <input id="t2y" type="range" min="0" max="100" step="0.5" />
        </div>
      </div>
    </section>

    <!-- IMAGE CONTROLS -->
    <section class="panel">
      <div class="panel-title">Images</div>

      <!-- upload buttons -->
      <div class="file-buttons">
        <label class="file-button">
          BG image
          <input id="bgFile" type="file" accept="image/*" />
        </label>
        <label class="file-button">
          Parlay image
          <input id="parlayFile" type="file" accept="image/*" />
        </label>
        <label class="file-button">
          Player PNG
          <input id="playerFile" type="file" accept="image/*" />
        </label>
      </div>

      <!-- default background presets -->
      <div class="bg-presets-label">
        or choose a background preset
      </div>
      <div class="bg-presets">
        <button
          class="bg-preset"
          data-url="https://t3.ftcdn.net/jpg/01/10/04/40/360_F_110044097_uaARe9sPt7YG92OnrneRYdLvHxPinYJX.jpg"
        >
          <img
            src="https://t3.ftcdn.net/jpg/01/10/04/40/360_F_110044097_uaARe9sPt7YG92OnrneRYdLvHxPinYJX.jpg"
            alt="Football background"
          />
          <span>Football</span>
        </button>

        <button
          class="bg-preset"
          data-url="https://images.freecreatives.com/wp-content/uploads/2016/03/Download-Sport-wallpaper.jpg"
        >
          <img
            src="https://images.freecreatives.com/wp-content/uploads/2016/03/Download-Sport-wallpaper.jpg"
            alt="Soccer background"
          />
          <span>Soccer</span>
        </button>

        <button
          class="bg-preset"
          data-url="https://static.vecteezy.com/system/resources/previews/012/809/329/non_2x/indoor-basketball-court-concept-background-free-vector.jpg"
        >
          <img
            src="https://static.vecteezy.com/system/resources/previews/012/809/329/non_2x/indoor-basketball-court-concept-background-free-vector.jpg"
            alt="Basketball background"
          />
          <span>Basketball</span>
        </button>

        <button
          class="bg-preset"
          data-url="https://freevector-images.s3.amazonaws.com/uploads/vector/preview/78175/vecteezywinter-activity-sport-backgroundAW0921_generated.jpg"
        >
          <img
            src="https://freevector-images.s3.amazonaws.com/uploads/vector/preview/78175/vecteezywinter-activity-sport-backgroundAW0921_generated.jpg"
            alt="Hockey background"
          />
          <span>Hockey</span>
        </button>
      </div>

      <div class="grid" style="margin-top:8px;">
        <div class="field">
          <label for="slipX">Slip X</label>
          <input id="slipX" type="range" min="0" max="100" step="0.5" />
        </div>
        <div class="field">
          <label for="slipY">Slip Y</label>
          <input id="slipY" type="range" min="0" max="100" step="0.5" />
        </div>
        <div class="field">
          <label for="slipWidth">Slip width %</label>
          <input id="slipWidth" type="range" min="10" max="100" step="1" />
        </div>
        <div class="field">
          <label for="playerWidth">Player width %</label>
          <input id="playerWidth" type="range" min="10" max="100" step="1" />
        </div>
        <div class="field">
          <label for="playerX">Player X</label>
          <input id="playerX" type="range" min="0" max="100" step="0.5" />
        </div>
        <div class="field">
          <label for="playerY">Player Y</label>
          <input id="playerY" type="range" min="0" max="100" step="0.5" />
        </div>
      </div>
    </section>

    <!-- PREVIEW + DOWNLOAD -->
    <section class="panel">
      <div class="panel-title">Preview (matches download)</div>
      <div class="preview-wrapper">
        <canvas id="previewCanvas" width="1080" height="1920"></canvas>
      </div>

      <div class="actions">
        <button id="downloadBtn">Download / Save image</button>
        <p class="hint">
          On iPhone: this opens the PNG—then long‑press and choose “Save Image”.
          On desktop/Android it downloads as a file.
        </p>
      </div>
    </section>
  </div>

  <script>
    const canvas = document.getElementById("previewCanvas");
    const ctx = canvas.getContext("2d");

    const state = {
      text1: "@LETSCASHSLIPS",
      text2: "WEEK 13 PARLAYS",
      text1Color: "#ffffff",
      text2Color: "#ffffff",
      text1Size: 80,
      text2Size: 64,

      t1x: 6,
      t1y: 4,
      t2x: 6,
      t2y: 80,

      slipX: 5,
      slipY: 20,
      slipWidth: 52, // percent of canvas width

      playerX: 56,
      playerY: 22,
      playerWidth: 46 // percent of canvas width
    };

    const images = {
      bg: { img: new Image(), loaded: false },
      parlay: { img: new Image(), loaded: false },
      player: { img: new Image(), loaded: false }
    };

    function draw() {
      const w = canvas.width;
      const h = canvas.height;

      // Base background
      ctx.clearRect(0, 0, w, h);
      const grd = ctx.createLinearGradient(0, 0, 0, h);
      grd.addColorStop(0, "#020617");
      grd.addColorStop(1, "#020617");
      ctx.fillStyle = grd;
      ctx.fillRect(0, 0, w, h);

      // BG image stretched to fill
      if (images.bg.loaded) {
        ctx.drawImage(images.bg.img, 0, 0, w, h);
      }

      // Parlay slip
      if (images.parlay.loaded) {
        const slipW = (state.slipWidth / 100) * w;
        const ratio = images.parlay.img.height / images.parlay.img.width;
        const slipH = slipW * ratio;
        const slipX = (state.slipX / 100) * w;
        const slipY = (state.slipY / 100) * h;
        ctx.drawImage(images.parlay.img, slipX, slipY, slipW, slipH);
      }

      // Player PNG
      if (images.player.loaded) {
        const playerW = (state.playerWidth / 100) * w;
        const ratio = images.player.img.height / images.player.img.width;
        const playerH = playerW * ratio;
        const playerX = (state.playerX / 100) * w;
        const playerY = (state.playerY / 100) * h;
        ctx.drawImage(images.player.img, playerX, playerY, playerW, playerH);
      }

      // Text 1
      ctx.textAlign = "left";
      ctx.textBaseline = "top";
      ctx.fillStyle = state.text1Color;
      ctx.font = `${state.text1Size}px 'Bebas Neue', sans-serif`;
      ctx.fillText(
        state.text1,
        (state.t1x / 100) * w,
        (state.t1y / 100) * h
      );

      // Text 2
      ctx.fillStyle = state.text2Color;
      ctx.font = `${state.text2Size}px 'Bebas Neue', sans-serif`;
      ctx.fillText(
        state.text2,
        (state.t2x / 100) * w,
        (state.t2y / 100) * h
      );
    }

    // ---- helpers to bind inputs ----
    function bindText(id, key) {
      const el = document.getElementById(id);
      el.value = state[key];
      el.addEventListener("input", () => {
        state[key] = el.value;
        draw();
      });
    }

    function bindRange(id, key) {
      const el = document.getElementById(id);
      el.value = state[key];
      el.addEventListener("input", () => {
        state[key] = parseFloat(el.value);
        draw();
      });
    }

    function bindNumber(id, key) {
      const el = document.getElementById(id);
      el.value = state[key];
      el.addEventListener("input", () => {
        const v = parseFloat(el.value);
        if (!Number.isNaN(v)) {
          state[key] = v;
          draw();
        }
      });
    }

    function bindColor(id, key) {
      const el = document.getElementById(id);
      el.value = state[key];
      el.addEventListener("input", () => {
        state[key] = el.value;
        draw();
      });
    }

    function handleFileInput(inputId, imageKey) {
      const input = document.getElementById(inputId);
      const obj = images[imageKey];

      input.addEventListener("change", (e) => {
        const file = e.target.files[0];
        if (!file) return;

        // If user uploads a custom BG, clear preset highlight
        if (imageKey === "bg") {
          document
            .querySelectorAll(".bg-preset")
            .forEach((b) => b.classList.remove("active"));
        }

        const reader = new FileReader();
        reader.onload = (ev) => {
          const img = new Image();
          img.onload = () => {
            obj.img = img;
            obj.loaded = true;
            draw();
          };
          img.src = ev.target.result;
        };
        reader.readAsDataURL(file);
      });
    }

    // Load BG from URL (for presets)
    function setBackgroundFromUrl(url) {
      const imgObj = images.bg;
      const img = new Image();
      img.crossOrigin = "anonymous"; // try to keep canvas exportable
      img.onload = () => {
        imgObj.img = img;
        imgObj.loaded = true;
        draw();
      };
      img.onerror = () => {
        console.warn("Could not load background from", url);
      };
      img.src = url;
    }

    // ---- bind text + sliders ----
    bindText("text1", "text1");
    bindText("text2", "text2");
    bindNumber("t1Size", "text1Size");
    bindNumber("t2Size", "text2Size");
    bindColor("text1Color", "text1Color");
    bindColor("text2Color", "text2Color");

    [
      "t1x",
      "t1y",
      "t2x",
      "t2y",
      "slipX",
      "slipY",
      "slipWidth",
      "playerX",
      "playerY",
      "playerWidth"
    ].forEach((key) => bindRange(key, key));

    // ---- file inputs ----
    handleFileInput("bgFile", "bg");
    handleFileInput("parlayFile", "parlay");
    handleFileInput("playerFile", "player");

    // ---- preset background buttons ----
    document.querySelectorAll(".bg-preset").forEach((btn) => {
      btn.addEventListener("click", () => {
        const url = btn.dataset.url;
        if (!url) return;

        // mark active
        document.querySelectorAll(".bg-preset").forEach((b) =>
          b.classList.toggle("active", b === btn)
        );

        // load bg
        setBackgroundFromUrl(url);
      });
    });

    // ---- download / save button ----
    document.getElementById("downloadBtn").addEventListener("click", () => {
      let dataUrl;
      try {
        dataUrl = canvas.toDataURL("image/png");
      } catch (err) {
        alert(
          "This background image doesn't allow downloading directly. " +
            "Try downloading it to your device and using the 'BG image' upload instead."
        );
        return;
      }

      const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);

      if (isIOS) {
        // iOS: open image so user can long‑press → Save Image
        const win = window.open();
        if (win) {
          win.document.write(`
            <html>
              <head><title>Save image</title></head>
              <body style="margin:0;background:#000;display:flex;align-items:center;justify-content:center;">
                <img src="${dataUrl}" style="max-width:100%;height:auto;"/>
              </body>
            </html>
          `);
          win.document.close();
        } else {
          window.location.href = dataUrl;
        }
      } else {
        // Desktop/Android: normal download
        const link = document.createElement("a");
        link.download = "parlay.png";
        link.href = dataUrl;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      }
    });

    // initial draw + default background (first preset)
    draw();
    const firstPreset = document.querySelector(".bg-preset");
    if (firstPreset && firstPreset.dataset.url) {
      firstPreset.classList.add("active");
      setBackgroundFromUrl(firstPreset.dataset.url);
    }
  </script>
</body>
</html>
